<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>订单列表</title>
    <link href="/admin/css/bootstrap.min.css" rel="stylesheet">
    <!-- jqgrid-->
    <link href="/admin/css/ui.jqgrid.css" rel="stylesheet">
    <link href="/admin/css/animate.min.css" rel="stylesheet">
    <link href="/admin/css/style.min.css" rel="stylesheet">
    <style>
    /*搜索框样式重写*/
    #searchmodfbox_table_list_2{
        position:absolute !important;
        top:302px !important;
        left:603px !important;
    }
    /*隐藏模态框*/
    #motaibox{
        display:none;
        z-index: 10;
        position:absolute;
        top:151px;
        left:228px;
        width:1200px;
    }
    </style>
</head>
<body class="gray-bg" style="overflow:hidden">
<div class="animated fadeInRight">
    <div class="row modal-content" id="motaibox">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5 class="title">订单详情</h5>
                    <div class="ibox-tools">
                        <!-- 点击关闭订单详情 -->
                        <a id="closeUserDetail">
                            <span class="glyphicon glyphicon-remove"></span>
                        </a>
                    </div>
                </div>
                <div class="ibox-content" id="table-box">
                    <!-- table -->
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox ">
                <div class="ibox-content">
                    <h4 class="m-t">订单列表</h4>
                    <div class="jqGrid_wrapper">
                        <table id="table_list_2"></table>
                        <div id="pager_list_2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 全局js -->
<script src="/admin/js/jquery-2.1.1.min.js"></script>
<script src="/admin/js/bootstrap.min.js?v=3.4.0"></script>

<!-- jqGrid -->
<script src="/admin/js/jqGrid/grid.locale-cn.js"></script>
<script src="/admin/js/jqGrid/jquery.jqGrid.min.js"></script>

<!-- 自定义js -->
<script src="/admin/js/content.min.js"></script>
<script>
    $(document).ready(function()
    {
        $.jgrid.defaults.styleUI="Bootstrap";
        $("#table_list_2").jqGrid({
            url:"/admin/home/getInquiry",
            datatype:"json",
            height:700,
            autowidth:true,
            shrinkToFit:true,
            rowNum:19,
            colNames:["序号","订单号","货主","货物","总量（吨）","偏差（吨）","海/河运","单价（RMB）","总价","船东","船舶","出发港","最早起运期","最迟起运期","到达港"],
            colModel:
                [   //默认不可编辑 可搜索 可排序
                    {name:"ID",index:"ID",sorttype:"int",key:true,width:20},
                    {name:"OrderNo",index:"OrderNo",sortable:false,width:60},
                    {name:"SupplyUserName",index:"SupplyUserName",sortable:false,width:60},
                    {name:"GoodsName",index:"GoodsName",sortable:false,width:50},
                    {name:"Qty",index:"Qty",sortable:false,search:false,width:50},
                    {name:"QtyDeviation",index:"QtyDeviation",sortable:false,search:false,width:50},
                    {name:"SeaOrRiver",index:"SeaOrRiver",width:50,sortable:false,search:false},
                    {name:"Price",index:"Price",sortable:false,width:40,search:false},
                    {name:"TotalSum",index:"TotalSum",sortable:false,width:40,search:false},
                    {name:"ShipUserName",index:"ShipUserName",sortable:false,width:60},
                    {name:"ShipName",index:"ShipName",sortable:false,width:60},
                    {name:"FromPortName",index:"FromPortName",sortable:false,width:50},
                    {name:"LoadDateFrom",index:"FromDate",sorttype:"date",width:50},
                    {name:"LoadDateTo",index:"ToDate",sorttype:"date",width:50},
                    {name:"ToPortName",index:"ToPortName",sortable:false,width:50}
                ],
            pager:"#pager_list_2",
            loadonce:true,
            viewrecords:true
        });
        $("#table_list_2").jqGrid("navGrid","#pager_list_2",{edit:false,add:false,del:false,search:true},{closeAfterEdit:true,reloadAfterSubmit:false});

        $(window).bind("resize",function(){var b=$(".jqGrid_wrapper").width();$("#table_list_2").setGridWidth(b)})
    });
    //添加方法 用户单击表格中每行弹出相应详情 非链接 模态框形式
    $("#table_list_2").on('dblclick','tr',function(){
        $("#motaibox").css("display","block");
        var ID=$(this).children().attr("title");
        console.log(ID);
        $.ajax({
            type:'GET',
            url:'/admin/home/GetoneInquiry?ID='+ID,
            success: function(res){
                var oneInquiry=JSON.parse(res).data;
                console.log(oneInquiry);
                var SEAORRIVER=new Array();
                SEAORRIVER[0]="河运";
                SEAORRIVER[1]="海运";
                var STATE=new Array();
                STATE[0]="刚发起";
                STATE[10]="另一方已阅";

                var html='';
                html=`<table class="table table-hover">
                        <tr><td colspan="6" bgcolor="#f5f5f5"><b>货主姓名：${oneInquiry.SupplyUserName}</b></td></tr>
                        <tr>
                            <td>货物名称：${oneInquiry.GoodsName}</td>
                            <td>货物总量：${oneInquiry.Qty}吨</td>
                            <td>偏差数量：${oneInquiry.QtyDeviation}吨</td>
                            <td>海运河运：${SEAORRIVER[oneInquiry.SeaOrRiver]}</td>
                            <td>运费单价：${oneInquiry.Price}RMB</td>
                            <td>运费总额：${oneInquiry.TotalSum}RMB</td>
                        </tr>
                        <tr><td colspan="6" bgcolor="#f5f5f5"><b>船东姓名：${oneInquiry.ShipUserName}</b></td></tr>
                        <tr>
                            <td>船舶名称：${oneInquiry.ShipName}</td>
                            <td>起运港口：${oneInquiry.FromPortName}</td>
                            <td>最早起运：${oneInquiry.LoadDateFrom}</td>
                            <td>最迟起运：${oneInquiry.LoadDateTo}</td>
                            <td>到达港口：${oneInquiry.ToPortName}</td>
                            <td>位置更新：${oneInquiry.LocationUpdateTime}</td>
                        </tr>
                        <tr><td colspan="6" bgcolor="#f5f5f5"><b>订单状态：${STATE[oneInquiry.State]}</b></td></tr>
                        <tr>
                            <td>下单日期：${oneInquiry.OrderDate}</td>
                            <td>退款日期：${oneInquiry.RefundDate}</td>
                            <td>支付时间：${oneInquiry.PayDate}</td>
                            <td>最后更新：${oneInquiry.UpdateUserName}</td>
                            <td colspan="2">更新时间：${oneInquiry.UpdateDate}</td>
                        </tr>
                    </table>`;
                $('#table-box').html(html);
            }
        });
    });
    //用户点击关闭，关闭模态框
    $("#closeUserDetail").click(function(){
        $("#motaibox").css("display","none");
    });
</script>
</body>
</html>