<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>用户列表</title>
<link href="/admin/css/bootstrap.min.css" rel="stylesheet">
<!-- jqgrid-->
<link href="/admin/css/ui.jqgrid.css" rel="stylesheet">
<link href="/admin/css/animate.min.css" rel="stylesheet">
<link href="/admin/css/style.min.css" rel="stylesheet">
<style>
/* 删除但未选中时的错误提示框 */
#alertmod_table_list_2{
    position:absolute !important;
    margin:0 auto !important;
    color:#1a7bb9;
    border:1px solid #1a7bb9;
    font-size:18px;
    width:400px !important;
    top:344px !important;
    left:628px !important;
    background-color:#f5f5f5;
}
/*编辑模态框样式重写*/
#editmodtable_list_2{
    position:absolute !important;
    top:71px !important;
    left:578px !important;
}
/*搜索框样式重写*/
#searchmodfbox_table_list_2{
    position:absolute !important;
    top:302px !important;
    left:603px !important;
}
/*隐藏详情模态框*/
#motaibox{
    display:none;
    background:rgba(0,0,0,0.3);
    z-index: 10;
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
}
</style>
</head>
<body class="gray-bg" style="overflow:hidden">
<div class="animated fadeInRight">
<!--点击表格中的每行弹出的模态框  显示对应用户的详细信息-->
    <div class="row modal-content" id="motaibox">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5 class="title">用户详情</h5>
                    <div class="ibox-tools">
                        <!-- 点击关闭用户详情 -->
                        <a id="closeUserDetail">
                            <span class="glyphicon glyphicon-remove"></span>
                        </a>
                    </div>
                </div>
                <div class="ibox-content" id="table-box">
                    <!-- table -->
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <div class="ibox ">
                <div class="ibox-content">
                    <h4 class="m-t">用户列表</h4>
                    <div class="jqGrid_wrapper">
                        <table id="table_list_2"></table>
                        <div id="pager_list_2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 全局js -->
<script src="/admin/js/jquery-2.1.1.min.js"></script>
<script src="/admin/js/bootstrap.min.js"></script>

<!-- jqGrid -->
<script src="/admin/js/jqGrid/grid.locale-cn.js"></script>
<script src="/admin/js/jqGrid/jquery.jqGrid.min.js"></script>

<!-- 自定义js-->
<script src="/admin/js/content.min.js"></script>
<script>
$(document).ready(function()
{
    $.jgrid.defaults.styleUI="Bootstrap";
    $("#table_list_2").jqGrid({
        url:"/admin/home/getUsers",
        datatype:"json",
        height:700,
        autowidth:true,
        shrinkToFit:true,
        rowNum:13,
        colNames:
        ["序号","账号","密码","用户类型","姓名","性别","手机","座机","邮箱","职位","积分","星级","认证状态"],
        colModel:
        [   //默认不可编辑 可搜索 可排序
            //实现功能：增删改
            //显示：序号、账号、用户类型、姓名、性别、手机、座机、邮箱、星级、积分、认证状态
            //可编辑：序号、账号、密码、用户类型、姓名、性别、头像、身份证1、身份证2、手机、座机、邮箱、职位、星级、积分、认证状态
            //可排序：UserID，星级，积分 sortable:false
            //不可搜索：search:false 用户类型 性别、职位 星级、积分 密码、头像、身份证1、身份证2、认证状态、最后更新时间
            //可搜索：序号，账号、姓名、手机、座机、邮箱、
            //隐藏列：密码可编辑 职位可编辑
            //必填项目：序号，账号，密码，用户类型，姓名，手机号
            {name:"UserID",index:"UserID",editable:false,width:30,sorttype:"int",key:true},
            {name:"Account",index:"Account",editable:true,width:80,sortable:false,editrules:{required:true}},
            {name:"Password",index:"Password",editable:true,width:0.1,sortable:false,search:false,editrules:{edithidden:true,required:true},hidden:true},
            {name:"UserType",index:"UserType",editable:true,width:50,sortable:false,
                edittype:'select',formatter:'select',editoptions:{value:"CD:船东;HZ:货主;DL:代理"},search:false,editrules:{required:true}},
            {name:"Name",index:"Name",editable:true,width:100,sortable:false,editrules:{required:true}},
            {name:"Sex",index:"Sex",editable:true,width:30,sortable:false,
                edittype:'select',formatter:'select',editoptions:{value:"1:男;2:女"},search:false},
            {name:"MobilePhone",index:"MobilePhone",editable:true,width:80,sortable:false,editrules:{required:true}},
            {name:"TelePhone",index:"TelePhone",editable:true,width:80,sortable:false},
            {name:"Email",index:"Email",editable:true,width:100,sortable:false},
            {name:"Duty",index:"Duty",editable:true,width:0.1,sortable:false,editrules:{edithidden:true},hidden:true,search:false},
            {name:"Point",index:"Point",editable:true,width:40,search:false,sorttype:"int"},
            {name:"Star",index:"Star",editable:true,width:80,edittype:'select',formatter:'select',editoptions:{value:"0:<img src='/admin/images/star0.png' alt='零星'>  零星;1:<img src='/admin/images/star1.png' alt='一星'>  一星;2:<img src='/admin/images/star2.png' alt='二星'>  二星;3:<img src='/admin/images/star3.png' alt='三星'>  三星;4:<img src='/admin/images/star4.png' alt='四星'>  四星;5:<img src='/admin/images/star5.png' alt='五星'>  五星"},search:false},
            {name:"CertifyState",index:"CertifyState",editable:true,width:80,sortable:false,search:false,edittype:"select",formatter:'select',editoptions:{value:"0:<button type='button' class='btn btn-default'>未经审核</button>;10:<button type='button' class='btn btn-success'>提交审核</button>;20:<button type='button' class='btn btn-danger'>审核未过</button>;30:<button type='button' class='btn btn-info'>审核通过</button>"}}
        ],
        multiselect:true,
        //翻页
        pager:"#pager_list_2",
        //一次性加载全部数据 没有此项导致不能翻页
        loadonce:true,
        //viewrecords是否显示总记录数
        viewrecords:true,
        //定义对form编辑时的url
        editurl:'/admin/user/save'
    });
    //reloadAfterSubmit:false 编辑后会刷新
    $("#table_list_2").jqGrid("navGrid","#pager_list_2",{edit:true,add:true,del:true,search:true},{closeAfterEdit:true,reloadAfterSubmit:false},{closeAfterAdd:true,reloadAfterSubmit:false});

    $(window).bind("resize",function(){
        var b=$(".jqGrid_wrapper").width();
        $("#table_list_2").setGridWidth(b);
    });
});

    //添加方法 用户双击表格中每行弹出相应用户的详情 非链接 模态框形式
    $("#table_list_2").on('dblclick','tr',function(){
        $("#motaibox").css("display","block");
        var UID=$(this).children().next().attr("title");
        $.ajax({
            type:'GET',
            url: '/admin/home/GetUser?UserID='+UID,
            success: function(res){
              var oneUser=JSON.parse(res).data;
              //console.log(oneUser);
              var CERTIFYSTATE=new Array();
                  CERTIFYSTATE[0] = "未经审核";
                  CERTIFYSTATE[10] = "提交审核";
                  CERTIFYSTATE[20] = "审核未过";
                  CERTIFYSTATE[30] = "审核通过";
              var SEX=new Array();
                  SEX[1]="男";
                  SEX[2]="女";
              var USERTYPE=new Array();
                  USERTYPE['CD']="船东";
                  USERTYPE['HZ']="货主";
                  USERTYPE['DL']="代理";
              var STAR=new Array();
                  STAR[0]="零星";
                  STAR[1]="一星";
                  STAR[2]="二星";
                  STAR[3]="三星";
                  STAR[4]="四星";
                  STAR[5]="五星";
              //设置默认图像
                oneUser.IDImage1==""?oneUser.IDImage1="/admin/images/someone.jpg":oneUser.IDImage1;
                oneUser.IDImage2==""?oneUser.IDImage2="/admin/images/someone.jpg":oneUser.IDImage2;
                oneUser.Avatar==""?oneUser.Avatar="/admin/images/someone.jpg":oneUser.Avatar;
              var html='';
              html=`<table class="table table-hover">
                        <tr>
                            <td>用户姓名：${oneUser.Name}</td>
                            <td>用户姓别：${SEX[oneUser.Sex]}</td>
                            <td>用户帐号：${oneUser.Account}</td>
                        </tr>
                        <tr>
                            <td>用户手机：${oneUser.MobilePhone}</td>
                            <td>用户座机：${oneUser.TelePhone}</td>
                            <td>用户邮箱：${oneUser.Email}</td>
                        </tr>
                        <tr>
                            <td>用户类型：${USERTYPE[oneUser.UserType]}</td>
                            <td>用户积分：${oneUser.Point}分</td>
                            <td>用户星级：${STAR[oneUser.Star]}</td>
                        </tr>
                        <tr>
                            <td>创&nbsp;&nbsp;建&nbsp;&nbsp;人：${oneUser.CreateUserName}</td>
                            <td>创建时间：${oneUser.CreateDate}</td>
                            <td>认证状态：${CERTIFYSTATE[oneUser.CertifyState]}</td>
                        </tr>
                        <tr>
                            <td>更新人：${oneUser.UpdateUserName}</td>
                            <td>更新时间：${oneUser.UpdateDate}</td>
                            <td>登录次数：${oneUser.LoginCount}次</td>
                        </tr>
                    </table>
                    <table class="table table-hover">
                        <tr>
                            <td>
                                <b>修改身份证（正面）</b><br/><br/>
                                <a><img src="${oneUser.IDImage1}" alt="证件" style="width:240px;heigth:150px;"></a><br/><br/>
                                <form class="form-inline" enctype="multipart/form-data" action="/admin/Postimage/PostIDImage1" method="post">
                                    <input type="hidden" name="UserID" value=${oneUser.UserID}/>
                                    <input name="file" type="file"><br/>
                                    <input type="submit" name="submitIDImage1" class="btn btn-success" value="保存"/>
                                </form>
                            </td>
                            <td>
                                <b>修改用户头像</b><br/><br/>
                                <a><img src="${oneUser.Avatar}" alt="头像" style="width:240px;heigth:150px;"></a><br/><br/>
                                <form class="form-inline" enctype="multipart/form-data" action="/admin/Postimage/PostAvatar" method="post">
                                    <input type="hidden" name="UserID" value=${oneUser.UserID}/>
                                    <input name="file" type="file"><br/>
                                    <input type="submit" name="submitAvatar" class="btn btn-success" value="保存"/>
                                </form>
                            </td>
                            <td>
                                <b>修改身份证（反面）</b><br/><br/>
                                <a><img src="${oneUser.IDImage2}" alt="证件" style="width:240px;heigth:150px;"></a><br/><br/>
                                <form class="form-inline" enctype="multipart/form-data" action="/admin/Postimage/PostIDImage2" method="post">
                                    <input type="hidden" name="UserID" value=${oneUser.UserID}/>
                                    <input name="file" type="file"><br/>
                                    <input type="submit" name="submitIDImage2" class="btn btn-success" value="保存"/>
                                </form>
                            </td>
                        </tr>
                    </table>`;
                $('#table-box').html(html);
            }
        });
    });

    //鼠标单击在td下的a下的img时图片放大
    $("#motaibox").on('click','img',function(){
        $(this).css({"width":"480px","height":"300px"});
    });
    $("#motaibox").on('mouseout','img',function(){
        $(this).css({"width":"240px","height":"150px"});
    });

    //用户点击关闭，关闭模态框
     $("#closeUserDetail").click(function(){
        $("#motaibox").css("display","none");
     });
</script>
</body>
</html>