<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>公司列表</title>
<link href="/admin/css/bootstrap.min.css" rel="stylesheet">
<!-- jqgrid-->
<link href="/admin/css/ui.jqgrid.css" rel="stylesheet">
<link href="/admin/css/animate.min.css" rel="stylesheet">
<link href="/admin/css/style.min.css" rel="stylesheet">
<style>
/* 删除但未选中时的错误提示框 */
#alertmod_table_list_2{
    position:absolute !important;
    margin:0 auto !important;
    color:#1a7bb9;
    border:1px solid #1a7bb9;
    font-size:18px;
    width:400px !important;
    top:344px !important;
    left:628px !important;
    background-color:#f5f5f5;
}
/*编辑模态框样式重写*/
#editmodtable_list_2{
    position:absolute !important;
    top:192px !important;
    left:578px !important;
}
/*搜索框样式重写*/
#searchmodfbox_table_list_2{
    position:absolute !important;
    top:302px !important;
    left:603px !important;
}
/*隐藏模态框*/
#motaibox{
    display:none;
    background:rgba(0,0,0,0.3);
    z-index: 10;
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
}
</style>
</head>
<body class="gray-bg" style="overflow:hidden">
<div class="animated fadeInRight">
<!--点击表格中的每行弹出的模态框  显示对应公司的详细信息-->
    <div class="row modal-content" id="motaibox">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5 class="title">公司详情</h5>
                    <div class="ibox-tools">
                        <!-- 点击关闭公司详情 -->
                        <a id="closeUserDetail">
                            <span class="glyphicon glyphicon-remove"></span>
                        </a>
                    </div>
                </div>
                <div class="ibox-content" id="table-box">
                    <!-- 表格 -->
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <div class="ibox ">
                <div class="ibox-content">
                    <h4 class="m-t">公司列表</h4>
                    <div class="jqGrid_wrapper">
                        <table id="table_list_2"></table>
                        <div id="pager_list_2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 全局js -->
<script src="/admin/js/jquery-2.1.1.min.js"></script>
<script src="/admin/js/bootstrap.min.js?v=3.4.0"></script>

<!-- jqGrid -->
<script src="/admin/js/jqGrid/grid.locale-cn.js"></script>
<script src="/admin/js/jqGrid/jquery.jqGrid.min.js"></script>

<!-- 自定义js -->
<script src="/admin/js/content.min.js"></script>
<script>
$(document).ready(function()
{
    $.jgrid.defaults.styleUI="Bootstrap";
    $("#table_list_2").jqGrid({
        url:"/admin/home/getCompanies",
        datatype:"json",
        height:700,
        autowidth:true,
        shrinkToFit:true,
        rowNum:13,
        colNames:
        ["序号","公司名称","公司地址","公司描述","客户类型","组织机构代码","认证状态"],
        colModel:
        [   //默认不可编辑 可搜索 可排序
            //实现功能：增删改
            //显示的列：序号、公司名称、地址、客户类型、组织机构代码、认证状态
            //隐藏列：描述Description
            //必填项：序号、公司名称、客户类型、组织机构代码editrules:{required:true,number:true}
            //有默认值的项目:客户类型 认证状态
            //可编辑：序号、公司名称、地址、描述、客户类型、组织机构代码、认证状态
            //可排序：序号
            //可搜索：序号、名称、地址、VIP，组织机构代码、认证状态
            {name:"ID",index:"ID",editable:false,width:15,sorttype:"int",key:true},
            {name:"Name",index:"Name",editable:true,width:120,sortable:false,editrules:{required:true}},
            {name:"Address",index:"Address",editable:true,width:120,sortable:false},
            {name:"Description",index:"Description",editable:true,width:0.1,search:false,sortable:false,editrules:{edithidden:true},hidden:true},
            {name:"VIP",index:"VIP",editable:true,width:50,edittype:"select",formatter:'select',editoptions:{value:"0:普通客户;1:VIP客户"},sortable:false,editrules:{required:true}},
            {name:"Code",index:"Code",editable:true,width:120,sortable:false,editrules:{required:true}},
            {name:"CertifyState",index:"CertifyState",editable:true,width:50,edittype:"select",formatter:'select',editoptions:{value:"0:<button type='button' class='btn btn-default'>未经审核</button>;10:<button type='button' class='btn btn-success'>提交审核</button>;20:<button type='button' class='btn btn-danger'>审核未过</button>;30:<button type='button' class='btn btn-info'>审核通过</button>",sortable:false,search:false}
            }
        ],
        multiselect:true,
        pager:"#pager_list_2",
        //一次性加载全部数据 没有此项导致不能翻页
        loadonce:true,
        viewrecords:true,
        editurl:'/admin/Company/save'
    });

    $("#table_list_2").jqGrid("navGrid","#pager_list_2",{edit:true,add:true,del:true,search:true},{closeAfterEdit:true,reloadAfterSubmit:false},{closeAfterAdd:true,reloadAfterSubmit:false});
    
    $(window).bind("resize",function(){var b=$(".jqGrid_wrapper").width();$("#table_list_2").setGridWidth(b)})
});

    //添加方法 双击表格中每行弹出相应公司的详情 非链接 模态框形式
    $("#table_list_2").on('dblclick','tr',function(){
        $("#motaibox").css("display","block");
        var CID=$(this).children().next().attr("title");
        $.ajax({
            type:'GET',
            url: '/admin/home/getCompany?ID='+CID,
            success: function(res){
              var oneCompany=JSON.parse(res).data;
              var CERTIFYSTATE=new Array();
                  CERTIFYSTATE[0] = "未经审核";
                  CERTIFYSTATE[10] = "提交审核";
                  CERTIFYSTATE[20] = "审核未过";
                  CERTIFYSTATE[30] = "审核通过";
              var VIP=new Array();
                  VIP[0]="普通客户";
                  VIP[1]="VIP客户";
              //设置默认图像
                oneCompany.CodeCertificate==""?oneCompany.CodeCertificate="/admin/images/company.jpg":oneCompany.CodeCertificate;
                oneCompany.BusinessLicenses==""?oneCompany.BusinessLicenses="/admin/images/company.jpg":oneCompany.BusinessLicenses;
                oneCompany.TaxRegistration==""?oneCompany.TaxRegistration="/admin/images/company.jpg":oneCompany.TaxRegistration;
              var html='';
              html=`<table class="table table-hover">
                        <tr>
                            <td>公司名称：${oneCompany.Name}</td>
                            <td>公司地址：${oneCompany.Address}</td>
                        </tr>
                        <tr>
                            <td>客户类型：${VIP[oneCompany.VIP]}</td>
                            <td>组织机构代码：${oneCompany.Code}</td>
                        </tr>
                        <tr>
                            <td>公司简介：${oneCompany.Description}</td>
                            <td>认证状态：${CERTIFYSTATE[oneCompany.CertifyState]}</td>
                        </tr>
                    </table>
                    <table class="table table-hover">
                        <tr>
                            <td>
                                <b>修改组织机构代码证</b><br/><br/>
                                <a><img src="${oneCompany.CodeCertificate}" alt="证件" style="display:block;width:300px;heigth:200px;"></a><br/><br/>
                                <form class="form-inline" enctype="multipart/form-data" action="/admin/Postimage/PostCodeCertificate" method="post">
                                    <input type="hidden" name="ID" value=${oneCompany.ID}/>
                                    <input name="file" type="file" multiple="true"><br/>
                                    <input type="submit" name="submitCodeCertificate" value="保存" class="btn btn-success"/>
                                </form>
                            </td>
                            <td>
                                <b>修改营业执照证</b><br/><br/>
                                <a><img src="${oneCompany.BusinessLicenses}" alt="证件" style="display:block;width:300px;heigth:200px;"></a><br/><br/>
                                <form class="form-inline" enctype="multipart/form-data" action="/admin/Postimage/PostBusinessLicenses" method="post">
                                    <input type="hidden" name="ID" value=${oneCompany.ID}/>
                                    <input name="file" type="file" multiple="true"><br/>
                                    <input type="submit" name="submitBusinessLicenses" value="保存" class="btn btn-success"/>
                                </form>
                            </td>
                            <td>
                                <b>修改税务登记证</b><br/><br/>
                                <a><img src="${oneCompany.TaxRegistration}" alt="证件" style="display:block;width:300px;heigth:200px;"></a><br/><br/>
                                <form class="form-inline" enctype="multipart/form-data" action="/admin/Postimage/PostTaxRegistration" method="post">
                                    <input type="hidden" name="ID" value=${oneCompany.ID}/>
                                    <input name="file" type="file" multiple="true"><br/>
                                    <input type="submit" name="submitTaxRegistration" value="保存" class="btn btn-success"/>
                                </form>
                            </td>
                        </tr>
                    </table>`;
                $('#table-box').html(html);
            }
        });
    });
    //鼠标悬停在td下的a下的img时图片放大
    $("#motaibox").on('click','img',function(){
        $(this).css({"width":"600px","height":"400px"});
    });
    $("#motaibox").on('mouseout','img',function(){
        $(this).css({"width":"300px","height":"200px"});
    });

    //用户点击关闭，关闭模态框
     $("#closeUserDetail").click(function(){
        $("#motaibox").css("display","none");
     });  
</script>
</body>
</html>