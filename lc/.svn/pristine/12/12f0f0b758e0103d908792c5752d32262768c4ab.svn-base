<!doctype html>
<html ng-app="myapp">
<head>
    <meta charset="UTF-8">
    <title>用户列表</title>
    <link rel="stylesheet" href="http://apps.bdimg.com/libs/jqueryui/1.10.4/css/jquery-ui.min.css">
    <script src="http://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>

    <!-- angularjs -->
    <script src="/admin/js/angular.min.js"></script>
    <script src="/admin/js/angular-animate.min.js"></script>
    <!--分页插件-->
    <script src="/admin/kindeditor-4.1.7/angular-ui-bootstrap.js"></script>

    <link href="/admin/css/animate.min.css" rel="stylesheet">

    <!--- bootstrap --->
    <script src="/admin/js/bootstrap.min.js"></script>
    <link href="/admin/css/bootstrap.min.css" rel="stylesheet">

    <!--- 后台公共样式表 --->
    <link href="/admin/css/style.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/common.css" />

    <!--- 原生JS与angularJS工具箱,工具箱通用对话框CSS --->
    <script src="/js/utils.js"></script>
    <link href="/css/zh-msg.css" rel="stylesheet">
    <script src="/js/syzxModule.js"></script>
</head>
<body ng-controller="mainCtrl" class="white-bg"  style="overflow: hidden;padding:20px;">
    <div class="animated fadeInRight">
        <div class="inquiry-btns">
            <button ng-class="add()" class="btn btn-default"><i class="glyphicon glyphicon-plus">新增</i></button>
            <button ng-click="del()" class="btn btn-danger"><i class="glyphicon glyphicon-trash"></i>删除</button>
            <button ng-click="refresh()" class="btn btn-info"><i class="glyphicon glyphicon-refresh"></i>刷新</button>
            <div class="input-group common-input-group">
                <input type="text" class="form-control search" ng-model="Name" onkeydown="if(event.keyCode == 13) search.click()" placeholder="Enter键搜索" />
                <span class="input-group-btn"><button ng-click="search()" id="search" class="btn btn-success">搜索</button></span>
            </div>
        </div>
        <ul class="pagination page-ul"
            uib-pagination
            boundary-links="true"
            previous-text="<"
            next-text=">"
            first-text="|<"
            last-text=">|"
            ng-change="pageChange();"
            ng-model="currentPage"
            force-ellipses="true"
            rotate="true"
            items-per-page="{# $ROWS_PER_PAGE #}"
            max-size = "5"
            total-items = "{# $UsersNum #}"
        ></ul>
    </div>

    <table class="datalist">
        <thead><tr>
            <td width="50">序号</td>
            <td width="30" ng-click="selectAll" title="选择全部/取消全部"><img src="/admin/images/checkbox.gif"></td>
            <td width="80">账号</td>
            <td width="50">用户类型</td>
            <td width="80">姓名</td>
            <td width="50">性别</td>
            <td width="80">手机</td>
            <td width="80">座机</td>
            <td width="100">邮箱</td>
            <td width="50">积分</td>
            <td width="120">星级</td>
            <td width="100">认证状态</td>
        </tr></thead>
        <tbody><tr ng-repeat="item in list track by $index" ng-click="showModal(item.ID,$event)">
            <td align="center">{{item.UserID}}</td>
            <td align="center"><input type="checkbox" ng-check="item.Checked==1" ng-model="item.Checked"></td>
            <td align="center">{{item.Account}}</td>
            <td align="center">{{item.UserType}}</td>
            <td align="center">{{item.Name}}</td>
            <td align="center">{{item.Sex}}</td>
            <td align="center">{{item.MobilePhone}}</td>
            <td align="center">{{item.TelePhone}}</td>
            <td align="center">{{item.Email}}</td>
            <td align="center">{{item.Point}}</td>
            <td align="center"><img src="/admin/images/star{{item.Star}}.png" /></td>
            <td align="center"><span style="padding: 3px 8px;border-radius: 3px;outline: none;" ng-class="{0:'btn-default',10:'btn-info',20:'btn-warning',30:'btn-success'}[{{item.CertifyState}}]">{{item.CertifyStateF}}</span></td>
        </tr></tbody>
    </table>
</body>
<script>
    var APP = angular.module("myapp",["ui.bootstrap","ngAnimate","utils"])
    APP.controller("mainCtrl",function($scope,$http,zhMsg)
    {
        $scope.pageChange = function()
        {   isSelectAll = false;
            getURL(utils.sprintf("/admin/user/getUsers?page=%d&Name=%s",$scope.currentPage,$scope.Name.trim())).then(function(data)
            {   $scope.list = data;
                for(var i=0;i<data.length;i++)
                {
                     if(data[i].CertifyState == 0)   data[i].CertifyStateF = "未经审核";
                    if(data[i].CertifyState == 10)   data[i].CertifyStateF = "提交审核";
                    if(data[i].CertifyState == 20)   data[i].CertifyStateF = "审核未过";
                    if(data[i].CertifyState == 30)   data[i].CertifyStateF = "审核通过";

                    if(data[i].UserType == "CD")    data[i].UserType = "船东";
                    if(data[i].UserType == "DL")    data[i].UserType = "代理";
                    if(data[i].UserType == "HZ")    data[i].UserType = "货主";

                    if(data[i].Sex == 0)    data[i].Sex = "男";
                    if(data[i].Sex == 1)    data[i].Sex = "女";
                }
            })
        }

        //============分页==========
        var isSelectAll = false;
        $scope.currentPage = 1;
        $scope.Name = "";
        $scope.pageChange();

        //全选和反选
        $scope.selectAll = function()
        {   isSelectAll = !isSelectAll;
            for(p in $scope.list)   $scope.list[p].Checked = isSelectAll;
        }

        //搜索
        $scope.search = function()
        {
            $scope.currentPage = 1;
            $scope.pageChange();
        }

        //刷新
        $scope.refresh = function() {   window.location.reload(); }








    })
</script>
</html>